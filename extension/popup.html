<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockPass - Secure Password Manager</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Splash / Onboarding Screen -->
    <div id="onboarding-screen" class="screen active">
        <div class="logo-container">
            <div class="logo">ğŸ”</div>
            <h1 class="app-name">BlockPass</h1>
            <p class="tagline">Your passwords, encrypted and verified by blockchain.</p>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" id="create-vault-btn">Create New Vault</button>
            <button class="btn btn-secondary" id="recover-vault-btn">Recover Existing Vault</button>
        </div>
    </div>

    <!-- Quick Unlock Screen (PIN/Biometric) -->
    <div id="quick-unlock-screen" class="screen">
        <div class="logo-container">
            <div class="logo">ğŸ”“</div>
            <h1 class="app-name">Welcome Back</h1>
            <p class="tagline">Enter your PIN to unlock your vault</p>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label>Enter PIN</label>
                <input type="password" id="quick-unlock-pin" placeholder="Enter your 6-digit PIN" class="input-field" maxlength="6" inputmode="numeric">
            </div>

            <button class="btn btn-primary" id="quick-unlock-btn">ğŸ”“ Unlock Vault</button>
            <button class="btn btn-secondary btn-small" id="use-recovery-phrase-btn">Use Recovery Phrase Instead</button>
            <button class="btn btn-danger btn-small" id="logout-clear-session-btn">ğŸšª Clear Session & Logout</button>
        </div>
    </div>

    <!-- Create Vault Screen -->
    <div id="create-vault-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="back-to-onboarding">â†</button>
            <h2>Create New Vault</h2>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label>Username or Email</label>
                <input type="text" id="username-input" placeholder="Enter your username or email" class="input-field">
            </div>

            <div class="mnemonic-section" id="mnemonic-section" style="display: none;">
                <h3>Your Recovery Phrase</h3>
                <p class="warning-text">âš ï¸ Save these 12 words securely. You'll need them to recover your vault.</p>
                <div class="mnemonic-grid" id="mnemonic-grid"></div>
                <button class="btn btn-secondary btn-small" id="copy-mnemonic-btn">ğŸ“‹ Copy Recovery Phrase</button>
                <button class="btn btn-primary" id="confirm-mnemonic-btn">I've saved my recovery phrase</button>
            </div>

            <div class="auth-method-section" id="auth-method-section" style="display: none;">
                <h3>Choose Authentication Method</h3>
                <div class="radio-group">
                    <label class="radio-option">
                        <input type="radio" name="auth-method" value="biometric" checked>
                        <span class="radio-label">
                            <span class="icon">ğŸ‘†</span>
                            <span>Biometric (WebAuthn)</span>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="auth-method" value="pin">
                        <span class="radio-label">
                            <span class="icon">ğŸ”¢</span>
                            <span>PIN</span>
                        </span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="auth-method" value="usb">
                        <span class="radio-label">
                            <span class="icon">ğŸ”‘</span>
                            <span>USB Security Key</span>
                        </span>
                    </label>
                </div>

                <div class="pin-setup" id="pin-setup" style="display: none;">
                    <input type="password" id="pin-input" placeholder="Enter 6-digit PIN" maxlength="6" class="input-field">
                    <input type="password" id="pin-confirm" placeholder="Confirm PIN" maxlength="6" class="input-field">
                </div>

                <button class="btn btn-primary" id="continue-dashboard-btn">Continue to Dashboard</button>
            </div>

            <button class="btn btn-primary" id="generate-mnemonic-btn">Generate Recovery Phrase</button>
        </div>
    </div>

    <!-- Recover Vault Screen -->
    <div id="recover-vault-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="back-to-onboarding-2">â†</button>
            <h2>Recover Vault</h2>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label>Enter Your 12-Word Recovery Phrase</label>
                <textarea id="recover-mnemonic-input" rows="4" placeholder="word1 word2 word3..." class="input-field"></textarea>
            </div>

            <div class="form-group">
                <label>LAN Backup Server IP (Optional)</label>
                <input type="text" id="backup-server-ip" placeholder="192.168.1.100:3000" class="input-field">
            </div>

            <button class="btn btn-primary" id="recover-vault-submit-btn">Recover Vault</button>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard-screen" class="screen">
        <div class="dashboard-header">
            <div class="header-left">
                <div class="logo-small">ğŸ”</div>
                <span class="username-display" id="username-display">User</span>
            </div>
            <div style="display: flex; gap: 8px;">
                <button class="btn-icon" id="lock-vault-btn" title="Lock Vault">ğŸ”’</button>
                <button class="btn-icon" id="settings-btn">âš™ï¸</button>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="search-input" placeholder="ğŸ” Search passwords..." class="input-field search-field">
        </div>

        <div class="password-list" id="password-list">
            <!-- Password entries will be added here dynamically -->
            <div class="empty-state" id="empty-state">
                <div class="empty-icon">ğŸ”’</div>
                <p>No passwords saved yet</p>
                <p class="empty-subtext">Click the + button to add your first password</p>
            </div>
        </div>

        <div class="backup-status" id="backup-status">
            <span class="status-indicator">ğŸŸ¢</span>
            <span class="status-text">Last backup: Never</span>
        </div>

        <button class="fab" id="add-password-btn">+</button>
    </div>

    <!-- Add/Edit Password Screen -->
    <div id="add-edit-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="back-to-dashboard">â†</button>
            <h2 id="add-edit-title">Add Password</h2>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label>Website / Domain</label>
                <input type="text" id="website-input" placeholder="example.com" class="input-field">
            </div>

            <div class="form-group">
                <label>Username / Email</label>
                <input type="text" id="email-input" placeholder="user@example.com" class="input-field">
            </div>

            <div class="form-group">
                <label>Password</label>
                <div class="password-input-group">
                    <input type="password" id="password-input" placeholder="Enter password" class="input-field">
                    <button class="btn-icon-small" id="toggle-password-visibility">ğŸ‘ï¸</button>
                    <button class="btn-icon-small" id="copy-password-btn">ğŸ“‹</button>
                </div>
                <button class="btn btn-secondary btn-small" id="generate-password-btn">âš¡ Generate Strong Password</button>
                <div class="password-strength" id="password-strength">
                    <div class="strength-bar">
                        <div class="strength-fill" id="strength-fill"></div>
                    </div>
                    <span class="strength-text" id="strength-text">Enter a password</span>
                </div>
            </div>

            <div class="form-group">
                <label>Notes (Optional)</label>
                <textarea id="notes-input" rows="3" placeholder="Additional notes..." class="input-field"></textarea>
            </div>

            <button class="btn btn-primary" id="save-password-btn">ğŸ”’ Encrypt & Save</button>
            <button class="btn btn-danger" id="delete-password-btn" style="display: none;">ğŸ—‘ï¸ Delete</button>
        </div>
    </div>

    <!-- View Password Screen -->
    <div id="view-password-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="back-to-dashboard-2">â†</button>
            <h2>View Password</h2>
        </div>

        <div class="auth-prompt" id="auth-prompt">
            <div class="lock-icon">ğŸ”“</div>
            <p>Authenticate to view password</p>
            <button class="btn btn-primary" id="authenticate-btn">Unlock Vault</button>
        </div>

        <div class="password-details" id="password-details" style="display: none;">
            <div class="detail-card">
                <div class="detail-row">
                    <span class="detail-label">Website</span>
                    <span class="detail-value" id="view-website"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Username</span>
                    <span class="detail-value" id="view-username"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Password</span>
                    <span class="detail-value password-revealed" id="view-password"></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Notes</span>
                    <span class="detail-value" id="view-notes"></span>
                </div>
            </div>

            <div class="auto-hide-timer" id="auto-hide-timer">
                Password will auto-hide in <span id="timer-seconds">10</span>s
            </div>

            <div class="button-group">
                <button class="btn btn-secondary" id="copy-view-password-btn">ğŸ“‹ Copy</button>
                <button class="btn btn-primary" id="edit-from-view-btn">âœï¸ Edit</button>
            </div>
        </div>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="back-to-dashboard-3">â†</button>
            <h2>Settings</h2>
        </div>

        <div class="settings-container">
            <div class="settings-section">
                <h3>Security Settings</h3>
                
                <div class="form-group">
                    <label>Session Timeout</label>
                    <select id="session-timeout-select" class="input-field">
                        <option value="0">Never (Stay logged in)</option>
                        <option value="5">5 minutes</option>
                        <option value="15" selected>15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60">1 hour</option>
                    </select>
                    <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.5rem;">
                        Auto-lock vault after inactivity
                    </p>
                </div>
                
                <button class="btn btn-secondary btn-full" id="change-pin-btn">ğŸ”‘ Change PIN</button>
                <button class="btn btn-secondary btn-full" id="manage-webauthn-btn">ğŸ” Manage WebAuthn Devices</button>
            </div>

            <div class="settings-section">
                <h3>Backup Settings</h3>
                <div class="form-group">
                    <label>Friend's Laptop IP</label>
                    <input type="text" id="backup-ip-input" placeholder="192.168.1.100:3000" class="input-field">
                </div>
                <button class="btn btn-primary btn-full" id="sync-now-btn">ğŸ”„ Sync Now</button>
            </div>

            <div class="settings-section">
                <h3>Blockchain Audit</h3>
                <label class="toggle-option">
                    <input type="checkbox" id="audit-toggle">
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Enable Local Audit Logs</span>
                </label>
                <div class="audit-info" id="audit-info">
                    <p class="info-text">Last logged hash: <span id="last-hash">N/A</span></p>
                    <p class="info-text">Timestamp: <span id="last-timestamp">N/A</span></p>
                </div>
            </div>

            <div class="settings-section">
                <h3>Recovery Info</h3>
                <button class="btn btn-secondary btn-full" id="show-mnemonic-btn">Show Recovery Phrase</button>
            </div>

            <div class="settings-section">
                <h3>Appearance</h3>
                <label class="toggle-option">
                    <input type="checkbox" id="theme-toggle" checked>
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">Dark Mode</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Password Generator Modal -->
    <div id="password-generator-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generate Password</h3>
                <button class="btn-close" id="close-generator-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="generated-password-display" id="generated-password-display">
                    <span id="generated-password-text"></span>
                    <button class="btn-icon-small" id="copy-generated-btn">ğŸ“‹</button>
                </div>
                
                <div class="form-group">
                    <label>Length: <span id="password-length-value">16</span></label>
                    <input type="range" id="password-length-slider" min="8" max="32" value="16" class="slider">
                </div>

                <label class="checkbox-option">
                    <input type="checkbox" id="include-uppercase" checked>
                    <span>Uppercase (A-Z)</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" id="include-lowercase" checked>
                    <span>Lowercase (a-z)</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" id="include-numbers" checked>
                    <span>Numbers (0-9)</span>
                </label>
                <label class="checkbox-option">
                    <input type="checkbox" id="include-symbols" checked>
                    <span>Symbols (!@#$%)</span>
                </label>

                <button class="btn btn-primary btn-full" id="regenerate-password-btn">ğŸ”„ Regenerate</button>
                <button class="btn btn-secondary btn-full" id="use-password-btn">Use This Password</button>
            </div>
        </div>
    </div>

    <!-- Backup Confirmation Modal -->
    <div id="backup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Backup to Server</h3>
            </div>
            <div class="modal-body">
                <p>Would you like to backup your vault to the server now?</p>
                <div class="button-group">
                    <button class="btn btn-secondary" id="backup-later-btn">Later</button>
                    <button class="btn btn-primary" id="backup-now-btn">Yes, Backup Now</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change PIN Modal -->
    <div id="change-pin-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change PIN</h3>
                <button class="btn-close" id="close-change-pin-modal">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Current PIN</label>
                    <input type="password" id="current-pin-input" placeholder="Enter current PIN" class="input-field" maxlength="6" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label>New PIN</label>
                    <input type="password" id="new-pin-input" placeholder="Enter new 6-digit PIN" class="input-field" maxlength="6" inputmode="numeric">
                </div>
                <div class="form-group">
                    <label>Confirm New PIN</label>
                    <input type="password" id="new-pin-confirm-input" placeholder="Re-enter new PIN" class="input-field" maxlength="6" inputmode="numeric">
                </div>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin: 1rem 0;">
                    âš ï¸ Changing your PIN will require re-authentication on all devices.
                </p>
                <button class="btn btn-primary btn-full" id="confirm-change-pin-btn">ğŸ”‘ Change PIN</button>
            </div>
        </div>
    </div>

    <script src="crypto.js"></script>
    <script src="popup.js"></script>
</body>
</html>
